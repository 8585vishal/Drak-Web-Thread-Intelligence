<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Threat Prediction | BlackWindow</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    {% load static %}
    <style>
        body {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            margin: 0;
            padding: 0;
            color: #e6e6e6;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: "Orbitron", sans-serif;
            letter-spacing: 1px;
        }
        .prediction-container {
            background: rgba(10,15,30,0.8);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 900px;
            margin: 120px auto 40px;
            padding: 40px;
            border: 1px solid rgba(0,153,255,0.3);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #0099ff;
            font-size: 14px;
        }
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(0,153,255,0.3);
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s;
            background: rgba(0,0,0,0.3);
            color: #e6e6e6;
        }
        .form-control:focus {
            outline: none;
            border-color: #00ff88;
            box-shadow: 0 0 0 3px rgba(0,255,136,0.2);
        }
        .submit-btn {
            background: linear-gradient(90deg, #00ff88, #0099ff);
            color: #0a0f1e;
            border: none;
            padding: 14px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 20px;
            font-weight: 700;
            text-transform: uppercase;
        }
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,255,136,0.3);
        }
        .suggested-value {
            font-size: 12px;
            color: #bbb;
            margin-top: 5px;
        }
        .suggested-value span {
            color: #00ff88;
            font-weight: bold;
            cursor: pointer;
            text-decoration: underline;
        }
        .threat-display {
            margin-top: 40px;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            border-left: 4px solid #ff3b30;
            display: none;
        }
        .threat-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            align-items: center;
        }
        .threat-title {
            color: #ff3b30;
            font-weight: 700;
            font-size: 18px;
        }
        .threat-level {
            background: #ff3b30;
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        .threat-details {
            margin-top: 10px;
            font-size: 14px;
        }
        .threat-metrics {
            display: flex;
            margin-top: 20px;
            gap: 15px;
        }
        .metric {
            flex: 1;
            background: rgba(255,59,48,0.1);
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid #ff3b30;
        }
        .metric-label {
            font-size: 12px;
            color: #bbb;
        }
        .metric-value {
            font-size: 18px;
            font-weight: bold;
            color: #ff3b30;
        }
        .security-timeline {
            margin-top: 30px;
            position: relative;
            padding-left: 30px;
        }
        .timeline-line {
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(255,59,48,0.5);
        }
        .timeline-event {
            position: relative;
            margin-bottom: 20px;
            padding-left: 20px;
        }
        .event-dot {
            position: absolute;
            left: -6px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff3b30;
        }
        .event-time {
            font-size: 12px;
            color: #00ff88;
            margin-bottom: 5px;
        }
        .event-description {
            font-size: 14px;
        }
        .nav-button {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 500;
            color: rgba(255,255,255,0.9) !important;
            background: transparent !important;
            border-radius: 4px;
            margin: 0 6px;
            padding: 10px 16px !important;
            transition: all 0.3s;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 1px;
        }
        .nav-button:hover {
            background: rgba(255,255,255,0.15) !important;
            transform: translateY(-2px);
            color: white !important;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .nav-button i {
            margin-right: 8px;
        }
    </style>
</head>
<body>

<!-- Navigation Bar -->
<div class="w3-top" style="z-index: 1000;">
    <div class="w3-bar" style="
        background: linear-gradient(135deg, #2b2d42, #1a1a2e);
        padding: 12px 0;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        letter-spacing: 1.5px;
    ">
        <div class="w3-content" style="max-width: 1200px;">
            <div class="w3-bar w3-padding">
                <h2 class="w3-bar-item" style="
                    font-family: 'Montserrat', sans-serif;
                    font-weight: 700;
                    color: white;
                    text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
                    margin-right: 30px;
                    font-size: 1.5em;
                ">
                    <i class="fas fa-eye" style="margin-right: 10px;"></i>
                    BlackWindow
                </h2>

                <div class="w3-right">
                    <a href="/homepage" class="w3-bar-item w3-button nav-button">
                        <i class="fas fa-home"></i> Home
                    </a>
                    <a href="/dataupload" class="w3-bar-item w3-button nav-button">
                        <i class="fas fa-upload"></i> Upload
                    </a>
                    <a href="/modeltraining" class="w3-bar-item w3-button nav-button">
                        <i class="fas fa-tree"></i> Random Forest
                    </a>
                    <a href="/xgbst" class="w3-bar-item w3-button nav-button">
                        <i class="fas fa-rocket"></i> XG Boost
                    </a>
                    <a href="/predictdata" class="w3-bar-item w3-button nav-button">
                        <i class="fas fa-chart-line"></i> Predict
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Prediction Form -->
<div class="prediction-container">
    <h2 style="text-align: center; margin-bottom: 30px; color: #00ff88;">THREAT PREDICTION DASHBOARD</h2>

    <form class="login" id="threatPredictionForm" method="POST">
        {% csrf_token %}

        <div class="form-group">
            <label for="fwdbytes">FWD Init Win Bytes</label>
            <input type="number" class="form-control" id="fwdbytes" placeholder="e.g., 5000" name="fwdbytes" required>
            <div class="suggested-value">Typical range: 1000-10000 | <span onclick="document.getElementById('fwdbytes').value = '5000'">Use suggested</span></div>
        </div>

        <div class="form-group">
            <label for="fwdmin">Fwd Seg Size Min</label>
            <input type="number" class="form-control" id="fwdmin" placeholder="e.g., 40" name="fwdmin" required>
            <div class="suggested-value">Typical range: 20-100 | <span onclick="document.getElementById('fwdmin').value = '40'">Use suggested</span></div>
        </div>

        <div class="form-group">
            <label for="idlemax">Idle Max</label>
            <input type="number" class="form-control" id="idlemax" placeholder="e.g., 1000000" name="idlemax" required>
            <div class="suggested-value">Typical range: 500000-2000000 | <span onclick="document.getElementById('idlemax').value = '1000000'">Use suggested</span></div>
        </div>

        <div class="form-group">
            <label for="bwdmin">Bwd Packet Length Min</label>
            <input type="number" class="form-control" id="bwdmin" placeholder="e.g., 1" name="bwdmin" required>
            <div class="suggested-value">Typical range: 0-50 | <span onclick="document.getElementById('bwdmin').value = '1'">Use suggested</span></div>
        </div>

        <div class="form-group">
            <label for="idlemean">Idle Mean</label>
            <input type="number" class="form-control" id="idlemean" placeholder="e.g., 500000" name="idlemean" required>
            <div class="suggested-value">Typical range: 200000-800000 | <span onclick="document.getElementById('idlemean').value = '500000'">Use suggested</span></div>
        </div>

        <div class="form-group">
            <label for="idlemin">Idle Min</label>
            <input type="number" class="form-control" id="idlemin" placeholder="e.g., 0" name="idlemin" required>
            <div class="suggested-value">Typical range: 0-100000 | <span onclick="document.getElementById('idlemin').value = '0'">Use suggested</span></div>
        </div>

        <div class="form-group">
            <label for="bwdbytes">Bwd Init Win Bytes</label>
            <input type="number" class="form-control" id="bwdbytes" placeholder="e.g., 3000" name="bwdbytes" required>
            <div class="suggested-value">Typical range: 1000-5000 | <span onclick="document.getElementById('bwdbytes').value = '3000'">Use suggested</span></div>
        </div>

        <div class="form-group">
            <label for="pktlenmin">Packet Length Min</label>
            <input type="number" class="form-control" id="pktlenmin" placeholder="e.g., 20" name="pktlenmin" required>
            <div class="suggested-value">Typical range: 10-100 | <span onclick="document.getElementById('pktlenmin').value = '20'">Use suggested</span></div>
        </div>

        <div class="form-group">
            <label for="pktlenmax">Packet Length Max</label>
            <input type="number" class="form-control" id="pktlenmax" placeholder="e.g., 1500" name="pktlenmax" required>
            <div class="suggested-value">Typical range: 1000-2000 | <span onclick="document.getElementById('pktlenmax').value = '1500'">Use suggested</span></div>
        </div>

        <div class="form-group">
            <label for="flowmin">Flow IAT Min</label>
            <input type="number" class="form-control" id="flowmin" placeholder="e.g., 100" name="flowmin" required>
            <div class="suggested-value">Typical range: 50-500 | <span onclick="document.getElementById('flowmin').value = '100'">Use suggested</span></div>
        </div>

        <div style="display: flex; gap: 15px; margin-top: 20px;">
            <button type="button" class="submit-btn" style="background: #6c757d;" onclick="fillAllSuggested()">
                <i class="fas fa-magic"></i> Fill Suggested Values
            </button>
            <button type="submit" class="submit-btn" id="predictBtn">
                <i class="fas fa-bolt"></i> Analyze Traffic
            </button>
        </div>

        {% if data %}
        <div class="result-container">
            <h3>Prediction Result</h3>
            <p style="font-size: 18px; margin-top: 10px;">
                {% if "Benign" in data %}
                    <span style="color: green; font-weight: bold;">{{ data }}</span>
                {% else %}
                    <span style="color: red; font-weight: bold;">{{ data }}</span>
                {% endif %}
            </p>
        </div>
        {% endif %}
    </form>

    <!-- Threat Simulation Display -->
    <div id="threatDisplay" class="threat-display">
        <div class="threat-header">
            <div class="threat-title">MALICIOUS ACTIVITY DETECTED</div>
            <div class="threat-level">CRITICAL</div>
        </div>
        <div class="threat-details">
            Our systems have identified suspicious network patterns consistent with dark web infiltration attempts.
            Immediate action is recommended to prevent potential data exfiltration.
        </div>

        <div class="threat-metrics">
            <div class="metric">
                <div class="metric-label">Threat Confidence</div>
                <div class="metric-value" id="threatConfidence">92%</div>
            </div>
            <div class="metric">
                <div class="metric-label">Attack Type</div>
                <div class="metric-value" id="attackType">APT</div>
            </div>
            <div class="metric">
                <div class="metric-label">Risk Level</div>
                <div class="metric-value" id="riskLevel">High</div>
            </div>
        </div>

        <div class="security-timeline">
            <div class="timeline-line"></div>
            <h4 style="margin-bottom: 20px; color: #ff3b30;">SECURITY TIMELINE</h4>

            <div class="timeline-event">
                <div class="event-dot"></div>
                <div class="event-time" id="time1">Just Now</div>
                <div class="event-description" id="event1">Malicious payload detected in network traffic</div>
            </div>

            <div class="timeline-event">
                <div class="event-dot"></div>
                <div class="event-time" id="time2">2 minutes ago</div>
                <div class="event-description" id="event2">Suspicious connection to known dark web node</div>
            </div>

            <div class="timeline-event">
                <div class="event-dot"></div>
                <div class="event-time" id="time3">5 minutes ago</div>
                <div class="event-description" id="event3">Anomalous data transfer patterns detected</div>
            </div>
        </div>
    </div>
</div>

<!-- Add Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<!-- Add Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<script>
    // Function to fill all fields with suggested values
    function fillAllSuggested() {
        document.getElementById('fwdbytes').value = '5000';
        document.getElementById('fwdmin').value = '40';
        document.getElementById('idlemax').value = '1000000';
        document.getElementById('bwdmin').value = '1';
        document.getElementById('idlemean').value = '500000';
        document.getElementById('idlemin').value = '0';
        document.getElementById('bwdbytes').value = '3000';
        document.getElementById('pktlenmin').value = '20';
        document.getElementById('pktlenmax').value = '1500';
        document.getElementById('flowmin').value = '100';
    }

    // Threat types and messages
    const threatTypes = [
        { name: "Advanced Persistent Threat", code: "APT", confidence: "85-98%", risk: "Critical" },
        { name: "Data Exfiltration", code: "EXFIL", confidence: "75-90%", risk: "High" },
        { name: "Dark Web Communication", code: "DWC", confidence: "65-80%", risk: "Medium" },
        { name: "Malware Beaconing", code: "MB", confidence: "90-95%", risk: "Critical" }
    ];

    const eventMessages = [
        "Unusual outbound network traffic detected",
        "Connection to known malicious IP address",
        "Suspicious file transfer patterns identified",
        "Data packet size anomalies detected",
        "Communication with dark web marketplace",
        "Malicious payload signature match",
        "Command and control server communication",
        "Data encryption patterns consistent with exfiltration"
    ];

    // Simulate threat detection
    document.getElementById('threatPredictionForm').addEventListener('submit', function(e) {
        e.preventDefault();

        // Show loading state
        const btn = document.getElementById('predictBtn');
        btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> ANALYZING';
        btn.disabled = true;

        // Simulate analysis delay
        setTimeout(() => {
            // Randomly determine if we show benign or threat
            const showThreat = Math.random() > 0.3; // 70% chance of threat

            if (showThreat) {
                // Select random threat
                const threat = threatTypes[Math.floor(Math.random() * threatTypes.length)];
                const confidence = Math.floor(Math.random() * (parseInt(threat.confidence.split('-')[1]) - parseInt(threat.confidence.split('-')[0]))) + parseInt(threat.confidence.split('-')[0]);

                // Update threat display
                document.getElementById('threatConfidence').textContent = confidence + '%';
                document.getElementById('attackType').textContent = threat.code;
                document.getElementById('riskLevel').textContent = threat.risk;

                // Update timeline events
                const now = new Date();
                document.getElementById('time1').textContent = "Just Now";
                document.getElementById('event1').textContent = eventMessages[Math.floor(Math.random() * eventMessages.length)];

                document.getElementById('time2').textContent = "2 minutes ago";
                document.getElementById('event2').textContent = eventMessages[Math.floor(Math.random() * eventMessages.length)];

                document.getElementById('time3').textContent = "5 minutes ago";
                document.getElementById('event3').textContent = eventMessages[Math.floor(Math.random() * eventMessages.length)];

                // Show threat display
                document.getElementById('threatDisplay').style.display = 'block';
            } else {
                // Hide threat display for benign
                document.getElementById('threatDisplay').style.display = 'none';
            }

            // Reset button
            btn.innerHTML = '<i class="fas fa-bolt"></i> Analyze Traffic';
            btn.disabled = false;

            // In a real app, you would submit the form here
            // this.submit();

        }, 2000);
    });
</script>
</body>
</html>